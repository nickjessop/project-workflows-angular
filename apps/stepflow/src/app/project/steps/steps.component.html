<div class="steps-container p-d-flex p-my-3">
    <div class="steps" @fade>
        <div class="steps__fade-right"></div>
        <div class="steps__fade-left"></div>
        <button
            pButton
            type="button"
            class="p-button-secondary p-button-raised p-button-rounded steps__arrow-left"
            icon="pi pi-chevron-left"
            *ngIf="scrollPosition > 20"
            (click)="scrollStepsLeft()"
        ></button>
        <button
            pButton
            type="button"
            class="p-button-secondary p-button-raised p-button-rounded steps__arrow-right"
            icon="pi pi-chevron-right"
            *ngIf="hasHorizontalScroll"
            (click)="scrollStepsRight()"
        ></button>
        <div class="steps__list" #scrollable>
            <ng-container *ngIf="steps?.length; else showEmptyState">
                <ng-container *ngIf="canConfigureProject; else showViewSteps">
                    <div
                        cdkDropList
                        cdkDropListOrientation="vertical"
                        (cdkDropListDropped)="drop($event)"
                        class="p-d-flex p-ai-center"
                    >
                        <ng-container *ngFor="let stepConfig of steps; index as i" #stepLoop>
                            <div
                                cdkDrag
                                class="step p-mr-2"
                                [class.step-selected]="stepConfig.step.isCurrentStep"
                                (click)="onStepPress(i)"
                            >
                                <project-step [step]="stepConfig.step"></project-step>
                                <button
                                    type="button"
                                    class="p-button-text p-button-plain step__edit p-jc-center p-p-0 p-mr-2"
                                    pButton
                                    icon="pi pi-ellipsis-h"
                                    (click)="menu.toggle($event)"
                                ></button>
                            </div>
                        </ng-container>
                        <div style="padding: 0 25px; height: 1px"></div>
                    </div>
                    <p-menu #menu [popup]="true" [model]="stepMenuOptions" appendTo="body"></p-menu>
                </ng-container>
                <ng-template #showViewSteps>
                    <div class="p-d-flex p-ai-center cdk-drop-list">
                        <ng-container *ngFor="let stepConfig of steps; index as i">
                            <div
                                class="step p-mr-2 cdk-drag"
                                [class.step-selected]="stepConfig.step.isCurrentStep"
                                (click)="onStepPress(i)"
                            >
                                <project-step [step]="stepConfig.step"></project-step>
                            </div>
                        </ng-container>
                    </div>
                </ng-template>
            </ng-container>
        </div>
        <button
            pButton
            type="button"
            icon="pi pi-plus"
            class="add-button p-button-text p-button-rounded p-ml-4 p-px-2"
            label="Add new step"
            (click)="onAddNewStepPress()"
            *ngIf="canConfigureProject"
        ></button>
    </div>
    <button
        pButton
        type="button"
        icon="pi pi-plus"
        class="add-icon p-button-text p-button-rounded p-ml-1"
        (click)="onAddNewStepPress()"
        *ngIf="canConfigureProject"
    ></button>

    <ng-template #showEmptyState>
        <div class="p-col-6 p-d-flex p-ai-center">Press the plus button to create your first step</div>
    </ng-template>
</div>

<ng-container *ngIf="showDialog">
    <project-step-dialog
        (dialogSubmitEvent)="onDialogSubmitEvent($event)"
        (onHideEvent)="onHideEvent($event)"
        [step]="focusStep"
        [mode]="stepMode"
        [(showDialog)]="showDialog"
    >
    </project-step-dialog>
</ng-container>
